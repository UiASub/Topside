{% extends "base.html" %}

{% block content %}
<div class="row g-4">
  <!-- Battery Card -->
  <div class="col-md-4">
    <div class="card custom-card h-100">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title">Battery</h5>
        <div class="progress mb-2">
          <div id="battery-progress" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
        </div>
        <p id="battery-status" class="card-text mt-auto">Loading...</p>
      </div>
    </div>
  </div>

  <!-- Depth Card -->
  <div class="col-md-4">
    <div class="card custom-card h-100">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title">Depth</h5>
        <p id="depth-status" class="display-6">Loading...</p>
        <small class="text-muted mt-auto">Target: <span id="depth-target">-</span></small>
      </div>
    </div>
  </div>

  <!-- Lights Card -->
  <div class="col-md-4">
    <div class="card custom-card h-100">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title">Lights</h5>
        <div id="light-data" class="mt-3">Loading...</div>
      </div>
    </div>
  </div>
</div>

<div class="row g-4 mt-1">
  <!-- Thruster Status -->
  <div class="col-md-8">
    <div class="card custom-card h-100">
      <div class="card-body">
        <h5 class="card-title">Thruster Status</h5>
        <table id="thruster-status-table" class="table custom-table">
          <thead>
            <tr>
              <th>Thruster</th>
              <th>Power (W)</th>
              <th>Temperature (Â°C)</th>
            </tr>
          </thead>
          <tbody>
            <!-- Dynamically populated by JavaScript -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Sensor Data -->
  <div class="col-md-4">
    <div class="card custom-card h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">Sensor Data (9DOF)</h5>
          <button id="calibrate-btn" class="btn btn-sm btn-outline-primary">Calibrate</button>
        </div>
        <div id="sensor-data" class="mt-3">Loading...</div>
      </div>
    </div>
  </div>
</div>

<!-- Resource Monitor -->
<div class="row g-4 mt-1">
  <div class="col-12">
    <div class="card custom-card">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="card-title mb-0">Resource Monitor</h5>
          <small id="connection-status" class="text-muted">Waiting for telemetry...</small>
        </div>

        <div class="row">
          <!-- CPU Gauge -->
          <div class="col-md-3 col-6 text-center">
            <svg viewBox="0 0 200 120" class="resource-gauge-svg">
              <path d="M 20 100 A 80 80 0 0 1 180 100" fill="none" stroke="#2d3748" stroke-width="12" stroke-linecap="round"/>
              <path id="cpu-arc" d="M 20 100 A 80 80 0 0 1 20 100" fill="none" stroke="#28a745" stroke-width="12" stroke-linecap="round"/>
              <text x="100" y="85" text-anchor="middle" fill="#fff" font-size="24" font-weight="bold" id="cpu-value">0%</text>
              <text x="100" y="110" text-anchor="middle" fill="#6c757d" font-size="14">CPU</text>
            </svg>
          </div>

          <!-- Memory Gauge -->
          <div class="col-md-3 col-6 text-center">
            <svg viewBox="0 0 200 120" class="resource-gauge-svg">
              <path d="M 20 100 A 80 80 0 0 1 180 100" fill="none" stroke="#2d3748" stroke-width="12" stroke-linecap="round"/>
              <path id="mem-arc" d="M 20 100 A 80 80 0 0 1 20 100" fill="none" stroke="#28a745" stroke-width="12" stroke-linecap="round"/>
              <text x="100" y="85" text-anchor="middle" fill="#fff" font-size="24" font-weight="bold" id="mem-value">0%</text>
              <text x="100" y="110" text-anchor="middle" fill="#6c757d" font-size="14">Memory</text>
            </svg>
            <div class="small text-muted">
              <span id="mem-free">Free: -- KB</span> / <span id="mem-total">Total: -- KB</span>
            </div>
          </div>

          <!-- Stats -->
          <div class="col-md-6">
            <div class="row g-2">
              <div class="col-6">
                <div class="stat-box">
                  <div class="stat-label">Uptime</div>
                  <div class="stat-value" id="uptime">--:--</div>
                </div>
              </div>
              <div class="col-6">
                <div class="stat-box">
                  <div class="stat-label">Threads</div>
                  <div class="stat-value" id="thread-count">--</div>
                </div>
              </div>
              <div class="col-6">
                <div class="stat-box">
                  <div class="stat-label">UDP Received</div>
                  <div class="stat-value" id="udp-rx">0</div>
                </div>
              </div>
              <div class="col-6">
                <div class="stat-box">
                  <div class="stat-label">UDP Errors</div>
                  <div class="stat-value" id="udp-errors">0</div>
                </div>
              </div>
              <div class="col-6">
                <div class="stat-box">
                  <div class="stat-label">Sequence</div>
                  <div class="stat-value" id="sequence">0</div>
                </div>
              </div>
              <div class="col-6">
                <div class="stat-box">
                  <div class="stat-label">Packets Lost</div>
                  <div class="stat-value" id="packets-lost">0</div>
                </div>
              </div>
            </div>
            <div class="mt-2 small text-muted">
              Last update: <span id="last-update">--:--:--</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row g-4 mt-1">
  <!-- Video Feed -->
  <div class="col-12">
    <div class="card custom-card h-100">
      <div class="card-body">
        <h5 class="card-title">Autonomus missions</h5>
          <div class="navigation">
            <button id="docking-button" type="button" class="btn btn-sm btn-primary">Docking</button>
              <button id="pipeline-button" type="button" class="btn btn-sm btn-primary">Pipeline</button>
          </div>
      </div>
    </div>
  </div>
</div>

{% include '_config_modal.html' %}


<script src="/static/js/thrusters.js"></script>
<script src="/static/js/sensors.js"></script>
<script src="/static/js/lights.js"></script>
<script src="/static/js/battery.js"></script>
<script src="/static/js/depth.js"></script>
<script src="/static/js/resource_monitor.js"></script>
{% endblock %}
